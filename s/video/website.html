<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Course Information Viewer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            min-height: 100vh;
        }
        
        .glow {
            box-shadow: 0 0 15px rgba(59, 130, 246, 0.5);
        }
        
        .card-hover {
            transition: all 0.3s ease;
        }
        
        .card-hover:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        }
        
        .futuristic-border {
            border: 1px solid rgba(59, 130, 246, 0.3);
            background: rgba(30, 41, 59, 0.7);
        }
        
        .neon-text {
            text-shadow: 0 0 5px rgba(59, 130, 246, 0.7);
        }
        
        .content-area {
            max-height: 70vh;
            overflow-y: auto;
        }
        
        /* Custom scrollbar */
        .content-area::-webkit-scrollbar {
            width: 8px;
        }
        
        .content-area::-webkit-scrollbar-track {
            background: #1e293b;
            border-radius: 10px;
        }
        
        .content-area::-webkit-scrollbar-thumb {
            background: #3b82f6;
            border-radius: 10px;
        }
        
        .content-area::-webkit-scrollbar-thumb:hover {
            background: #2563eb;
        }
        
        .course-card {
            background: rgba(30, 41, 59, 0.8);
            border-left: 4px solid #3b82f6;
            transition: all 0.3s ease;
        }
        
        .course-card:hover {
            background: rgba(30, 41, 59, 1);
            transform: translateX(5px);
        }
        
        .lecture-item {
            border-bottom: 1px solid #334155;
            transition: background 0.2s;
        }
        
        .lecture-item:hover {
            background: rgba(51, 65, 85, 0.5);
        }
        
        .badge {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            border-radius: 0.375rem;
            font-size: 0.75rem;
            font-weight: 600;
        }
        
        .badge-open {
            background-color: #10b981;
            color: white;
        }
        
        .badge-closed {
            background-color: #ef4444;
            color: white;
        }
        
        .badge-pdf {
            background-color: #f59e0b;
            color: white;
        }
        
        .badge-class {
            background-color: #8b5cf6;
            color: white;
        }
        
        .url-display {
            background: rgba(30, 41, 59, 0.9);
            border: 1px solid #3b82f6;
            border-radius: 0.5rem;
            padding: 1rem;
            word-break: break-all;
        }
    </style>
</head>
<body class="text-gray-200">
    <div class="container mx-auto px-4 py-8">
        <!-- Header -->
        <header class="text-center mb-12">
            <h1 class="text-4xl md:text-5xl font-bold mb-4 neon-text">
                <i class="fas fa-graduation-cap mr-3 text-blue-500"></i>
                Course Information Viewer
            </h1>
            <p class="text-lg text-gray-400 max-w-2xl mx-auto">
                Course data loaded from URL parameter. Use website.html?url=YOUR_JSON_URL
            </p>
        </header>
        
        <!-- Current URL Display -->
        <div class="max-w-4xl mx-auto mb-8">
            <div class="futuristic-border rounded-xl p-6">
                <h2 class="text-2xl font-semibold mb-4 flex items-center">
                    <i class="fas fa-link mr-3 text-blue-500"></i>
                    Current Data Source
                </h2>
                <div class="url-display">
                    <span id="currentUrl">Loading...</span>
                </div>
                <div class="mt-4 text-sm text-gray-400">
                    <i class="fas fa-info-circle mr-2"></i>
                    Change the URL parameter to load different course data
                </div>
            </div>
        </div>
        
        <!-- Content Display Section -->
        <div class="max-w-6xl mx-auto">
            <div class="futuristic-border rounded-xl overflow-hidden">
                <div class="bg-slate-800 px-6 py-4 flex justify-between items-center">
                    <h2 class="text-xl font-semibold flex items-center">
                        <i class="fas fa-book-open mr-3 text-blue-500"></i>
                        Course Details
                    </h2>
                    <div class="flex items-center space-x-4">
                        <span id="status" class="text-sm px-3 py-1 bg-slate-700 rounded-full">
                            Loading...
                        </span>
                        <button id="copyBtn" class="text-gray-400 hover:text-white transition" title="Copy Data">
                            <i class="fas fa-copy"></i>
                        </button>
                    </div>
                </div>
                
                <div class="p-6">
                    <div id="contentArea" class="content-area bg-slate-900 rounded-lg p-6 min-h-64">
                        <div class="text-center py-12">
                            <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-4"></div>
                            <p>Loading course data...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Instructions -->
        <div class="max-w-4xl mx-auto mt-12">
            <div class="futuristic-border rounded-xl p-6">
                <h3 class="text-xl font-semibold mb-4 flex items-center">
                    <i class="fas fa-question-circle mr-3 text-blue-500"></i>
                    How to Use
                </h3>
                <div class="space-y-3 text-gray-300">
                    <p>1. Add your JSON URL as a parameter: <code class="bg-slate-800 px-2 py-1 rounded">website.html?url=YOUR_JSON_URL</code></p>
                    <p>2. The page will automatically fetch and display the course data</p>
                    <p>3. Make sure your JSON follows the course data structure</p>
                    <p class="text-sm text-gray-400 mt-4">
                        <i class="fas fa-exclamation-triangle mr-2"></i>
                        Note: Due to CORS restrictions, you may need to use a CORS proxy for external URLs
                    </p>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const contentArea = document.getElementById('contentArea');
            const status = document.getElementById('status');
            const copyBtn = document.getElementById('copyBtn');
            const currentUrl = document.getElementById('currentUrl');
            
            // Get URL parameter
            function getUrlParameter(name) {
                name = name.replace(/[\[\]]/g, '\\$&');
                const regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)');
                const results = regex.exec(window.location.href);
                if (!results) return null;
                if (!results[2]) return '';
                return decodeURIComponent(results[2].replace(/\+/g, ' '));
            }
            
            // Load data from URL parameter
            function loadDataFromUrl() {
                const url = getUrlParameter('url');
                
                if (!url) {
                    showError('No URL parameter found. Please add ?url=YOUR_JSON_URL to the address bar.');
                    currentUrl.textContent = 'No URL parameter provided';
                    return;
                }
                
                currentUrl.textContent = url;
                currentUrl.innerHTML = `<a href="${url}" target="_blank" class="text-blue-400 hover:text-blue-300">${url}</a>`;
                
                fetchData(url);
            }
            
            // Fetch and display data
            function fetchData(url) {
                status.textContent = 'Loading...';
                status.className = 'text-sm px-3 py-1 bg-yellow-600 rounded-full';
                
                // Using a proxy to avoid CORS issues
                const proxyUrl = 'https://api.allorigins.win/raw?url=';
                
                fetch(proxyUrl + encodeURIComponent(url))
                    .then(response => {
                        if (!response.ok) {
                            throw new Error(`HTTP error! status: ${response.status}`);
                        }
                        return response.json();
                    })
                    .then(data => {
                        displayCourseData(data);
                        status.textContent = 'Loaded';
                        status.className = 'text-sm px-3 py-1 bg-green-600 rounded-full';
                    })
                    .catch(error => {
                        console.error('Error fetching data:', error);
                        showError(`Failed to load course data: ${error.message}`);
                        status.textContent = 'Error';
                        status.className = 'text-sm px-3 py-1 bg-red-600 rounded-full';
                    });
            }
            
            // Display course data in a structured format
            function displayCourseData(courseData) {
                let html = `
                    <div class="mb-8">
                        <h2 class="text-2xl font-bold mb-4 text-blue-400">Course ID: ${courseData.id}</h2>
                        
                        <!-- Course Descriptions -->
                        ${courseData.descriptions && courseData.descriptions.length > 0 ? `
                            <div class="mb-6">
                                <h3 class="text-xl font-semibold mb-3 flex items-center">
                                    <i class="fas fa-info-circle mr-2 text-blue-500"></i>
                                    Course Details
                                </h3>
                                <div class="space-y-4">
                                    ${courseData.descriptions.map(desc => `
                                        <div class="course-card p-4 rounded-lg">
                                            <h4 class="font-semibold text-lg mb-2">${desc.question}</h4>
                                            <div class="text-gray-300">${formatHtmlContent(desc.answer)}</div>
                                            <div class="mt-2 text-xs text-gray-500">
                                                Created: ${formatDate(desc.created_at)} | Updated: ${formatDate(desc.updated_at)}
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        ` : ''}
                        
                        <!-- Course Sections -->
                        ${courseData.sections && courseData.sections.length > 0 ? `
                            <div class="mb-6">
                                <h3 class="text-xl font-semibold mb-3 flex items-center">
                                    <i class="fas fa-list-alt mr-2 text-blue-500"></i>
                                    Course Sections
                                </h3>
                                <div class="space-y-6">
                                    ${courseData.sections.map(section => `
                                        <div class="bg-slate-800 rounded-lg p-4">
                                            <h4 class="font-semibold text-lg mb-3">Section ID: ${section.id}</h4>
                                            <div class="space-y-4">
                                                ${section.lectures && section.lectures.length > 0 ? section.lectures.map(lecture => `
                                                    <div class="lecture-item p-3 rounded">
                                                        <div class="flex justify-between items-start mb-2">
                                                            <h5 class="font-medium text-lg">${lecture.title}</h5>
                                                            <div class="flex space-x-2">
                                                                <span class="badge ${lecture.is_open ? 'badge-open' : 'badge-closed'}">
                                                                    ${lecture.is_open ? 'Open' : 'Closed'}
                                                                </span>
                                                                ${lecture.is_enrolled ? `
                                                                    <span class="badge badge-open">Enrolled</span>
                                                                ` : ''}
                                                            </div>
                                                        </div>
                                                        
                                                        <!-- Lecture Items -->
                                                        ${lecture.items && lecture.items.length > 0 ? `
                                                            <div class="ml-4 mt-2 space-y-2">
                                                                ${lecture.items.map(item => `
                                                                    <div class="flex justify-between items-center py-2 px-3 bg-slate-700 rounded">
                                                                        <div class="flex items-center">
                                                                            <span class="badge ${item.type === 'PDF' ? 'badge-pdf' : 'badge-class'} mr-2">
                                                                                ${item.type}
                                                                            </span>
                                                                            <span>${item.title}</span>
                                                                        </div>
                                                                        <div class="flex space-x-2">
                                                                            ${item.url ? `
                                                                                <a href="${item.url}" target="_blank" class="text-blue-400 hover:text-blue-300" title="Open Link">
                                                                                    <i class="fas fa-external-link-alt"></i>
                                                                                </a>
                                                                            ` : ''}
                                                                            <span class="badge ${item.is_open ? 'badge-open' : 'badge-closed'}">
                                                                                ${item.is_open ? 'Open' : 'Closed'}
                                                                            </span>
                                                                        </div>
                                                                    </div>
                                                                `).join('')}
                                                            </div>
                                                        ` : '<p class="text-gray-500 text-sm ml-4">No items in this lecture</p>'}
                                                    </div>
                                                `).join('') : '<p class="text-gray-500">No lectures in this section</p>'}
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        ` : ''}
                        
                        <!-- Empty Arrays Information -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-6">
                            ${courseData.preps && courseData.preps.length === 0 ? `
                                <div class="bg-slate-800 p-3 rounded text-center">
                                    <i class="fas fa-users text-gray-500 mb-2"></i>
                                    <p class="text-gray-400">No Preps</p>
                                </div>
                            ` : ''}
                            
                            ${courseData.mentors && courseData.mentors.length === 0 ? `
                                <div class="bg-slate-800 p-3 rounded text-center">
                                    <i class="fas fa-chalkboard-teacher text-gray-500 mb-2"></i>
                                    <p class="text-gray-400">No Mentors</p>
                                </div>
                            ` : ''}
                            
                            ${courseData.course_images && courseData.course_images.length === 0 ? `
                                <div class="bg-slate-800 p-3 rounded text-center">
                                    <i class="fas fa-images text-gray-500 mb-2"></i>
                                    <p class="text-gray-400">No Course Images</p>
                                </div>
                            ` : ''}
                            
                            ${courseData.routines && courseData.routines.length === 0 ? `
                                <div class="bg-slate-800 p-3 rounded text-center">
                                    <i class="fas fa-calendar-alt text-gray-500 mb-2"></i>
                                    <p class="text-gray-400">No Routines</p>
                                </div>
                            ` : ''}
                        </div>
                    </div>
                `;
                
                contentArea.innerHTML = html;
            }
            
            // Format HTML content safely
            function formatHtmlContent(html) {
                const tempDiv = document.createElement('div');
                tempDiv.innerHTML = html;
                return tempDiv.innerHTML;
            }
            
            // Format date for better display
            function formatDate(dateString) {
                if (!dateString) return 'N/A';
                try {
                    const date = new Date(dateString);
                    return date.toLocaleDateString() + ' ' + date.toLocaleTimeString();
                } catch (e) {
                    return dateString;
                }
            }
            
            // Show error message
            function showError(message) {
                contentArea.innerHTML = `
                    <div class="text-center py-8 text-red-400">
                        <i class="fas fa-exclamation-triangle text-4xl mb-4"></i>
                        <p class="text-xl mb-2">Error Loading Data</p>
                        <p class="text-sm mb-4">${message}</p>
                        <div class="mt-4 p-4 bg-slate-800 rounded-lg">
                            <p class="text-sm text-gray-300">Usage: website.html?url=https://example.com/course.json</p>
                        </div>
                    </div>
                `;
            }
            
            // Show status message
            function showMessage(message, type) {
                const oldStatus = status.textContent;
                const oldClass = status.className;
                
                status.textContent = message;
                status.className = `text-sm px-3 py-1 rounded-full ${
                    type === 'error' ? 'bg-red-600' : 'bg-green-600'
                }`;
                
                setTimeout(() => {
                    status.textContent = oldStatus;
                    status.className = oldClass;
                }, 3000);
            }
            
            // Copy content to clipboard
            copyBtn.addEventListener('click', function() {
                if (contentArea.textContent && !contentArea.textContent.includes('Loading course data')) {
                    navigator.clipboard.writeText(contentArea.textContent)
                        .then(() => {
                            showMessage('Content copied to clipboard', 'success');
                        })
                        .catch(err => {
                            showMessage('Failed to copy content', 'error');
                        });
                }
            });
            
            // Initialize - load data from URL parameter
            loadDataFromUrl();
        });
    </script>
</body>
</html>
