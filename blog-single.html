<!DOCTYPE html>
<html lang="en">
   <head>
      <meta charset="utf-8">
      <meta content="width=device-width, initial-scale=1.0" name="viewport">
      <title>SABBIR28 Blog</title>
      <meta content="" name="description">
      <meta content="" name="keywords">
      <!-- Favicons -->
      <link href="assets/img/favicon.png" rel="icon">
      <link href="assets/img/apple-touch-icon.png" rel="apple-touch-icon">
      <!-- Vendor CSS Files -->
      <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
      <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
      <link href="assets/vendor/glightbox/css/glightbox.min.css" rel="stylesheet">
      <link href="assets/vendor/swiper/swiper-bundle.min.css" rel="stylesheet">
      <!-- Template Main CSS File -->
      <link href="assets/css/style.css" rel="stylesheet">
   </head>
   <body>
      <!-- ======= Header ======= -->
      <header id="header" class="fixed-top">
         <div class="container d-flex align-items-center justify-content-between">
            <h1 class="logo">
               <a href="/index.html">SABBIR28</a>
            </h1>
            <nav id="navbar" class="navbar">
               <ul>
                  <li><a class="nav-link scrollto active" href="/#hero">Home</a></li>
                  <li><a class="nav-link scrollto" href="/#about">About</a></li>
                  <li><a class="nav-link scrollto" href="/#services">Services</a></li>
                  <li><a class="nav-link scrollto" href="/#work">Work</a></li>
                  <li><a href="https://sabbir28.github.io/p/Mr.Trafick/index.html">Mr.Trafick</a></li>
               </ul>
               <i class="bi bi-list mobile-nav-toggle"></i>
            </nav>
         </div>
      </header>
      <!-- End Header -->

      <!-- Blog Header Section -->
      <div class="blog-header" style="position: relative; background-color: #000; color: white; padding: 100px 0;">
         <div class="background-image" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-image: url('assets/img2/330123352_652174763576660_5704459054495859963_n.jpg'); background-size: cover; background-position: center; opacity: 0.3;"></div>
         <div class="dark-overlay" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.7);"></div>
         <div class="container" style="position: relative; z-index: 2; text-align: center;">
            <h1 id="blog-title" class="blog-title" style="font-size: 3rem; font-weight: bold; margin-bottom: 20px; color: white;"></h1>
            <div id="blog-meta" class="blog-meta" style="font-size: 1.2rem;">
               <span id="blog-category"></span> &bull; 
               <span id="blog-date"></span>
            </div>
         </div>
      </div>

      <main id="main">
         <!-- Blog Single Section -->
         <section class="blog-wrapper sect-pt4" id="blog">
            <div class="container">
               <div class="row">
                  <div class="col-md-8">
                     <div class="post-box">
                        <div class="post-thumb">
                           <img src="assets/img/post-1.jpg" class="img-fluid" alt="">
                        </div>
                        <div class="post-meta">
                           <h1 id="blog-title-1" class="article-title"></h1>
                           <ul>
                              <li>
                                 <span class="bi bi-person"></span>
                                 <a href="#" id="creator-link">John Doe</a>
                              </li>
                              <li>
                                 <span class="bi bi-chat-left-text"></span>
                                 <a href="#" id="comment-count">0</a>
                              </li>
                           </ul>
                        </div>
                        <div class="article-content" id="blog-content">
                           <!-- Blog content will go here -->
                        </div>
                     </div>
                     <div class="box-comments">
                        <div class="title-box-2">
                           <h4 class="title-comments title-left" id="comment-title">Comments (0)</h4>
                        </div>
                        <ul class="list-comments" id="comments-list">
                           <!-- Comments will be dynamically populated here -->
                        </ul>
                     </div>

                     <!-- Comment Form -->
                     <div class="form-comments">
                        <div class="title-box-2">
                           <h3 class="title-left">Leave a Reply</h3>
                        </div>
                        <form class="form-mf" id="commentForm">
                           <div class="row">
                              <div class="col-md-12 mb-3">
                                 <div class="form-group">
                                    <input type="text" class="form-control input-mf" id="inputName" placeholder="Name *" required>
                                 </div>
                              </div>
                              <div class="col-md-12 mb-3">
                                 <div class="form-group">
                                    <textarea id="textMessage" class="form-control input-mf" placeholder="Comment *" name="message" cols="45" rows="8" required></textarea>
                                 </div>
                              </div>
                              <div class="col-md-12">
                                 <button type="submit" class="button button-a button-big button-rouded">Send Message</button>
                              </div>
                           </div>
                        </form>
                     </div>
                  </div>
                  <div class="col-md-4">
                     <!-- Sidebar content here -->
                  </div>
               </div>
            </div>
         </section>
      </main>

      <!-- Footer -->
      <footer>
         <div class="container">
            <div class="row">
               <div class="col-sm-12 text-center">
                  <div class="copyright-box">
                     <p class="copyright">&copy; 2021 - <span id="current-year"></span> <strong>Sabbir</strong>. All Rights Reserved.</p>
                     <div class="credits">Designed by <a href="https://alor28.web.app/" target="_blank" rel="noopener noreferrer">Alor28</a></div>
                  </div>
               </div>
            </div>
         </div>
      </footer>

 <script>
   // Function to get query parameter by name
   function getQueryParam(param) {
      const urlParams = new URLSearchParams(window.location.search);
      return urlParams.get(param);
   }

   // Set the current year dynamically
   document.getElementById('current-year').textContent = new Date().getFullYear();

   // Function to update the blog header details
   function updateBlogHeader(title, category, date) {
      const blogTitle = document.getElementById('blog-title');
      const blogCategory = document.getElementById('blog-category');
      const blogDate = document.getElementById('blog-date');

      blogTitle.textContent = title;
      blogCategory.textContent = `Category: ${category}`;
      blogDate.textContent = `Published: ${new Date(date).toLocaleDateString()}`;
   }

   // Helper function to escape potentially dangerous HTML characters
   function escapeHTML(unsafeString) {
      const div = document.createElement('div');
      div.textContent = unsafeString;
      return div.innerHTML;
   }

   // Get blog ID from the query parameter in the URL
   const blogId = getQueryParam('id');

   if (!blogId) {
      alert("Blog ID is missing in the URL.");
      window.location = "/";
   } else {
      // Fetch blog data from the API URL
      const apiUrl = `https://s28-core-api.vercel.app/api/v1/blog/${blogId}`;

      async function fetchBlogDetails() {
         try {
            const response = await fetch(apiUrl);
            const blog = await response.json();

            document.getElementById('blog-title-1').textContent = blog.title;
            document.getElementById('creator-link').textContent = blog.creator;
            document.getElementById('comment-count').textContent = blog.commentCount;
            document.getElementById('blog-content').textContent = blog.content;

            updateBlogHeader(blog.title, blog.category, blog.updatedAt);

            // Populate comments
            const commentsList = document.getElementById('comments-list');
            commentsList.innerHTML = ''; // Clear existing comments

            blog.comments.forEach(comment => {
               const commentItem = document.createElement('li');

               // Escape commenterName and commentText to prevent HTML injection
               const safeCommenterName = escapeHTML(comment.commenterName);
               const safeCommentText = escapeHTML(comment.commentText);
               const safeTimestamp = new Date(comment.timestamp).toLocaleDateString();  // No need to escape date

               commentItem.innerHTML = `
                  <div class="comment-details">
                     <h4 class="comment-author">${safeCommenterName}</h4>
                     <span>${safeTimestamp}</span>
                     <p>${safeCommentText}</p>
                  </div>
               `;
               commentsList.appendChild(commentItem);
            });

            document.getElementById('comment-title').textContent = `Comments (${blog.commentCount})`;

         } catch (error) {
            console.error('Error fetching blog data:', error);
         }
      }

      fetchBlogDetails();

      // API URL for posting a comment
      const apiUrlk = `https://s28-core-api.vercel.app/api/v1/blog/${blogId}/comment`;

      // Function to submit the comment form
      document.getElementById('commentForm').addEventListener('submit', async function (e) {
         e.preventDefault(); // Prevent form from refreshing the page

         const commenterName = document.getElementById('inputName').value;
         const commentText = document.getElementById('textMessage').value;

         const commentData = {
            commenterName: commenterName,
            commentText: commentText
         };

         try {
            const response = await fetch(apiUrlk, {
               method: 'POST',
               headers: {
                  'Content-Type': 'application/json'
               },
               body: JSON.stringify(commentData)
            });

            if (response.ok) {
               document.getElementById('commentForm').reset();
               alert('Comment posted successfully!');
               fetchBlogDetails(); // Refresh comments
            } else {
               throw new Error('Failed to post comment');
            }
         } catch (error) {
            console.error('Error posting comment:', error);
            alert('An error occurred while posting your comment.');
         }
      });
   }
</script>



      <!-- Vendor JS Files -->
      <script src="assets/vendor/purecounter/purecounter_vanilla.js"></script>
      <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
      <script src="assets/vendor/glightbox/js/glightbox.min.js"></script>
      <script src="assets/vendor/swiper/swiper-bundle.min.js"></script>
      <script src="assets/vendor/typed.js/typed.umd.js"></script>
      <script src="assets/vendor/php-email-form/validate.js"></script>
      <!-- Template Main JS File -->
      <script src="assets/js/main.js"></script>
   </body>
</html>
