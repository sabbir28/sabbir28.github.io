<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Modern Study Timer</title>
  <script src="https://cdn.jsdelivr.net/npm/react@18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@babel/standalone@7.22.5/babel.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/framer-motion@10.12.16/dist/framer-motion.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      margin: 0;
      padding: 0;
      min-height: 100vh;
      background: linear-gradient(135deg, #1e3a8a, #7e22ce);
      display: flex;
      justify-content: center;
      align-items: center;
      overflow-x: hidden;
    }
    #root {
      width: 100%;
      max-width: 100%;
      box-sizing: border-box;
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;
    const { motion } = window.FramerMotion;

    const STUDY_DURATION = 60 * 60;
    const BREAK_DURATION = 10 * 60;
    const TOTAL_STAGES = 6;

    const StudyTimer = () => {
      const [currentStage, setCurrentStage] = useState(() =>
        parseInt(localStorage.getItem('currentStage')) || 0
      );
      const [timeLeft, setTimeLeft] = useState(STUDY_DURATION);
      const [isRunning, setIsRunning] = useState(false);
      const [isStudyPhase, setIsStudyPhase] = useState(true);
      const [error, setError] = useState(null);

      useEffect(() => {
        localStorage.setItem('currentStage', currentStage);
        if (currentStage >= TOTAL_STAGES) {
          setIsRunning(false);
        }
      }, [currentStage]);

      useEffect(() => {
        let timer;
        if (isRunning && timeLeft > 0) {
          timer = setInterval(() => {
            setTimeLeft(prev => prev - 1);
          }, 1000);
        } else if (timeLeft <= 0 && isRunning) {
          handleStageTransition();
        }
        return () => clearInterval(timer);
      }, [isRunning, timeLeft]);

      const playSound = (url) => {
        try {
          const audio = new Audio(url);
          audio.play().catch(() => {
            console.warn("Audio failed to play. Browser may block autoplay.");
          });
        } catch {
          setError('Audio playback failed');
        }
      };

      const handleStageTransition = () => {
        playSound('https://assets.mixkit.co/sfx/preview/mixkit-clear-announce-tones-2861.mp3');

        if (!isStudyPhase) {
          setCurrentStage(prev => prev + 1);
        }

        setIsStudyPhase(!isStudyPhase);
        setTimeLeft(isStudyPhase ? BREAK_DURATION : STUDY_DURATION);
      };

      const startTimer = () => {
        if (currentStage < TOTAL_STAGES) {
          setIsRunning(true);
        }
      };

      const resetTimer = () => {
        setIsRunning(false);
        setCurrentStage(0);
        setTimeLeft(STUDY_DURATION);
        setIsStudyPhase(true);
        localStorage.setItem('currentStage', '0');
      };

      const formatTime = (seconds) => {
        const mins = Math.floor(seconds / 60);
        const secs = seconds % 60;
        return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
      };

      const duration = isStudyPhase ? STUDY_DURATION : BREAK_DURATION;
      const progress = ((duration - timeLeft) / duration) * 100;
      const circleOffset = 283 - (283 * progress) / 100;

      return error ? (
        <div className="text-white text-center p-4">Error: {error}</div>
      ) : (
        <div className="flex flex-col items-center justify-center min-h-screen text-white p-4">
          <motion.h1 
            className="text-4xl font-bold mb-8"
            initial={{ opacity: 0, y: -50 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ duration: 0.5 }}
          >
            {currentStage >= TOTAL_STAGES
              ? 'Session Complete!'
              : isStudyPhase
              ? 'Study Session'
              : 'Break Time'}
          </motion.h1>

          <motion.div className="relative w-64 h-64 mb-8" animate={{ scale: isRunning ? 1.05 : 1 }}>
            <svg className="w-full h-full" viewBox="0 0 100 100">
              <circle cx="50" cy="50" r="45" fill="none" stroke="#4B5563" strokeWidth="10" />
              <motion.circle
                cx="50"
                cy="50"
                r="45"
                fill="none"
                stroke="#ffffff"
                strokeWidth="10"
                strokeDasharray="283"
                strokeDashoffset={circleOffset}
                strokeLinecap="round"
                animate={{ strokeDashoffset: circleOffset }}
                transition={{ duration: 0.5 }}
              />
            </svg>
            <motion.div 
              className="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-3xl"
              animate={{ scale: isRunning ? 1.1 : 1 }}
            >
              {formatTime(timeLeft)}
            </motion.div>
          </motion.div>

          <div className="flex items-center mb-8">
            {[...Array(TOTAL_STAGES)].map((_, index) => (
              <div key={index} className="flex items-center">
                <motion.div
                  className={`w-8 h-8 rounded-full ${
                    index < currentStage
                      ? 'bg-green-400'
                      : index === currentStage
                      ? 'bg-white'
                      : 'bg-gray-600'
                  }`}
                  animate={{ scale: index === currentStage ? 1.2 : 1 }}
                />
                {index < TOTAL_STAGES - 1 && (
                  <div
                    className={`w-6 h-1 ${
                      index < currentStage
                        ? 'bg-green-400'
                        : index === currentStage
                        ? 'bg-white'
                        : 'bg-gray-600'
                    }`}
                  />
                )}
              </div>
            ))}
          </div>

          <div className="flex space-x-4">
            <motion.button
              onClick={startTimer}
              className="px-6 py-3 bg-white text-black rounded-lg font-semibold disabled:opacity-50"
              disabled={isRunning || currentStage >= TOTAL_STAGES}
              whileHover={{ scale: 1.05 }}
              whileTap={{ scale: 0.95 }}
            >
              {isRunning ? 'Running...' : 'Start Timer'}
            </motion.button>

            <motion.button
              onClick={resetTimer}
              className="px-6 py-3 bg-red-500 text-white rounded-lg font-semibold"
              whileHover={{ scale: 1.05 }}
              whileTap={{ scale: 0.95 }}
            >
              Reset
            </motion.button>
          </div>
        </div>
      );
    };

    try {
      const root = ReactDOM.createRoot(document.getElementById('root'));
      root.render(<StudyTimer />);
    } catch (err) {
      document.getElementById('root').innerHTML = `
        <div style="color: white; text-align: center; padding: 20px;">
          <h1>Error Loading Timer</h1>
          <p>${err.message}</p>
          <p>Please ensure you're using a modern browser and have an internet connection.</p>
        </div>
      `;
    }
  </script>
</body>
</html>
