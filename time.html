<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Modern Study Timer</title>

  <!-- React and Babel -->
  <script src="https://cdn.jsdelivr.net/npm/react@18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@babel/standalone@7.22.5/babel.min.js"></script>

  <!-- Framer Motion (UMD version compatible with browsers) -->
  <script src="https://cdn.jsdelivr.net/npm/framer-motion@7.6.16/dist/framer-motion.umd.js"></script>

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    body {
      margin: 0;
      padding: 0;
      min-height: 100vh;
      background: linear-gradient(135deg, #1e3a8a, #7e22ce);
      display: flex;
      justify-content: center;
      align-items: center;
      overflow-x: hidden;
    }
    #root {
      width: 100%;
      max-width: 100%;
      box-sizing: border-box;
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;
    const { motion } = window.framerMotion;

    const STUDY_DURATION = 60 * 60; // 60 minutes
    const BREAK_DURATION = 10 * 60; // 10 minutes
    const TOTAL_STAGES = 6;

    const StudyTimer = () => {
      const [currentStage, setCurrentStage] = useState(() =>
        parseInt(localStorage.getItem('currentStage')) || 0
      );
      const [timeLeft, setTimeLeft] = useState(STUDY_DURATION);
      const [isRunning, setIsRunning] = useState(false);
      const [isStudyPhase, setIsStudyPhase] = useState(true);
      const [error, setError] = useState(null);

      useEffect(() => {
        localStorage.setItem('currentStage', currentStage);
        if (currentStage >= TOTAL_STAGES) {
          setIsRunning(false);
          try {
            new Audio('https://assets.mixkit.co/sfx/preview/mixkit-achievement-bell-600.mp3').play().catch(err => {
              console.error('Audio play failed:', err);
            });
          } catch (err) {
            setError('Audio playback failed');
          }
        }
      }, [currentStage]);

      useEffect(() => {
        let timer;
        if (isRunning && timeLeft > 0) {
          timer = setInterval(() => {
            setTimeLeft(prev => prev - 1);
          }, 1000);
        } else if (timeLeft <= 0) {
          handleStageTransition();
        }
        return () => clearInterval(timer);
      }, [isRunning, timeLeft]);

      const handleStageTransition = () => {
        try {
          new Audio('https://assets.mixkit.co/sfx/preview/mixkit-clear-announce-tones-2861.mp3').play().catch(err => {
            console.error('Audio play failed:', err);
          });
        } catch (err) {
          setError('Transition audio failed');
        }
        setCurrentStage(prev => prev + 1);
        setIsStudyPhase(prev => !prev);
        setTimeLeft(isStudyPhase ? BREAK_DURATION : STUDY_DURATION);
      };

      const startTimer = () => {
        if (currentStage < TOTAL_STAGES) {
          setIsRunning(true);
        }
      };

      const resetTimer = () => {
        setIsRunning(false);
        setCurrentStage(0);
        setTimeLeft(STUDY_DURATION);
        setIsStudyPhase(true);
        localStorage.setItem('currentStage', '0');
      };

      const formatTime = (seconds) => {
        const mins = Math.floor(seconds / 60);
        const secs = seconds % 60;
        return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
      };

      const progressPercentage = ((isStudyPhase ? STUDY_DURATION : BREAK_DURATION - timeLeft) /
        (isStudyPhase ? STUDY_DURATION : BREAK_DURATION)) * 100;

      if (error) {
        return <div className="text-white text-center p-4">Error: {error}</div>;
      }

      return (
        <div className="flex flex-col items-center justify-center min-h-screen text-white p-4">
          <motion.h1
            className="text-4xl font-bold mb-8"
            initial={{ opacity: 0, y: -50 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ duration: 0.5 }}
          >
            {isStudyPhase ? 'Study Session' : 'Break Time'}
          </motion.h1>

          <motion.div
            className="relative w-64 h-64 mb-8"
            animate={{ scale: isRunning ? 1.05 : 1 }}
            transition={{ duration: 0.3 }}
          >
            <svg className="w-full h-full" viewBox="0 0 100 100">
              <circle cx="50" cy="50" r="45" fill="none" stroke="#4B5563" strokeWidth="10" />
              <motion.circle
                cx="50"
                cy="50"
                r="45"
                fill="none"
                stroke="#ffffff"
                strokeWidth="10"
                strokeDasharray="283"
                strokeDashoffset={283 - (283 * progressPercentage) / 100}
                strokeLinecap="round"
                initial={{ strokeDashoffset: 283 }}
                animate={{ strokeDashoffset: 283 - (283 * progressPercentage) / 100 }}
                transition={{ duration: 0.5 }}
              />
            </svg>
            <motion.div
              className="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-3xl"
              animate={{ scale: isRunning ? 1.1 : 1 }}
              transition={{ duration: 0.3 }}
            >
              {formatTime(timeLeft)}
            </motion.div>
          </motion.div>

          <div className="flex items-center mb-8">
            {[...Array(TOTAL_STAGES)].map((_, index) => (
              <div key={index} className="flex items-center">
                <motion.div
                  className={`w-8 h-8 rounded-full ${index < currentStage ? 'bg-green-400' :
                    index === currentStage ? 'bg-white' : 'bg-gray-600'}`}
                  animate={{ scale: index === currentStage ? 1.2 : 1 }}
                  transition={{ duration: 0.3 }}
                />
                {index < TOTAL_STAGES - 1 && (
                  <div className={`w-6 h-1 ${index < currentStage ? 'bg-green-400' :
                    index === currentStage ? 'bg-white' : 'bg-gray-600'}`} />
                )}
              </div>
            ))}
          </div>

          <div className="flex space-x-4">
            <motion.button
              onClick={startTimer}
              className="px-6 py-3 bg-white text-black rounded-lg font-semibold disabled:opacity-50"
              disabled={isRunning || currentStage >= TOTAL_STAGES}
              whileHover={{ scale: 1.05 }}
              whileTap={{ scale: 0.95 }}
            >
              {isRunning ? 'Running...' : 'Start Timer'}
            </motion.button>
            <motion.button
              onClick={resetTimer}
              className="px-6 py-3 bg-red-500 text-white rounded-lg font-semibold"
              whileHover={{ scale: 1.05 }}
              whileTap={{ scale: 0.95 }}
            >
              Reset
            </motion.button>
          </div>
        </div>
      );
    };

    try {
      const root = ReactDOM.createRoot(document.getElementById('root'));
      root.render(<StudyTimer />);
    } catch (err) {
      document.getElementById('root').innerHTML = `
        <div style="color: white; text-align: center; padding: 20px;">
          <h1>Error Loading Timer</h1>
          <p>${err.message}</p>
          <p>Please ensure you're using a modern browser and have an internet connection.</p>
        </div>
      `;
    }
  </script>
</body>
</html>
